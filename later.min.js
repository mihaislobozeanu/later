later=function(){"use strict";var t={version:"1.2.0"};return Array.prototype.indexOf||(Array.prototype.indexOf=function(t){if(null==this)throw new TypeError;var e=Object(this),n=e.length>>>0;if(0===n)return-1;var r=0;if(arguments.length>1&&(r=Number(arguments[1]),r!=r?r=0:0!=r&&r!=1/0&&r!=-1/0&&(r=(r>0||-1)*Math.floor(Math.abs(r)))),r>=n)return-1;for(var a=r>=0?r:Math.max(n-Math.abs(r),0);a<n;a++)if(a in e&&e[a]===t)return a;return-1}),String.prototype.trim||(String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g,"")}),t.array={},t.array.sort=function(t,e){t.sort(function(t,e){return+t-+e}),e&&0===t[0]&&t.push(t.shift())},t.array.next=function(t,e,n){for(var r,a=0!==n[0],i=0,u=e.length-1;u>-1;--u){if((r=e[u])===t)return r;if(!(r>t||0===r&&a&&n[1]>t))break;i=u}return e[i]},t.array.nextInvalid=function(t,e,n){for(var r=n[0],a=n[1],i=e.length,u=0===e[i-1]&&0!==r?a:0,o=t,f=e.indexOf(t),d=o;o===(e[f]||u);)if(o++,o>a&&(o=r),f++,f===i&&(f=0),o===d)return;return o},t.array.prev=function(t,e,n){for(var r,a=e.length,i=0!==n[0],u=a-1,o=0;o<a;o++){if((r=e[o])===t)return r;if(!(r<t||0===r&&i&&n[1]<t))break;u=o}return e[u]},t.array.prevInvalid=function(t,e,n){for(var r=n[0],a=n[1],i=e.length,u=0===e[i-1]&&0!==r?a:0,o=t,f=e.indexOf(t),d=o;o===(e[f]||u);)if(o--,o<r&&(o=a),f--,-1===f&&(f=i-1),o===d)return;return o},t.day=t.D={name:"day",range:86400,val:function(e){return e.D||(e.D=t.date.getDate.call(e))},isValid:function(e,n){return t.D.val(e)===(n||t.D.extent(e)[1])},extent:function(e){if(e.DExtent)return e.DExtent;var n=t.M.val(e),r=t.DAYS_IN_MONTH[n-1];return 2===n&&366===t.dy.extent(e)[1]&&(r+=1),e.DExtent=[1,r]},start:function(e){return e.DStart||(e.DStart=t.date.next(t.Y.val(e),t.M.val(e),t.D.val(e)))},end:function(e){return e.DEnd||(e.DEnd=t.date.prev(t.Y.val(e),t.M.val(e),t.D.val(e)))},next:function(e,n){n=n>t.D.extent(e)[1]?1:n;var r=t.date.nextRollover(e,n,t.D,t.M),a=t.D.extent(r)[1];return n=n>a?1:n||a,t.date.next(t.Y.val(r),t.M.val(r),n)},prev:function(e,n){var r=t.date.prevRollover(e,n,t.D,t.M),a=t.D.extent(r)[1];return t.date.prev(t.Y.val(r),t.M.val(r),n>a?a:n||a)}},t.dayEx=t.DX={rangeStart:new Date("2015-01-01"),rangeEnd:new Date("2050-01-01"),name:"dayEx",range:86400,val:function(e){return e.DX||(e.DX=t.date.diffInDays(t.DX.rangeStart,e))},isValid:function(e,n){return t.DX.val(e)===(n||t.DX.extent(e)[1])},extent:function(e){if(e.DXExtent)return e.DXExtent;var n=Math.floor(t.DX.rangeEnd.getTime()/t.DAY)-Math.floor(t.DX.rangeStart.getTime()/t.DAY);return e.DXExtent=[1,n]},start:function(e){return e.DXStart||(e.DXStart=t.date.next(t.Y.val(e),t.M.val(e),t.D.val(e)))},end:function(e){return e.DXEnd||(e.DXEnd=t.date.prev(t.Y.val(e),t.M.val(e),t.D.val(e)))},next:function(e,n){return new Date(t.DX.rangeStart.getTime()+n*t.DAY)},prev:function(e,n){return new Date(t.DX.rangeStart.getTime()+n*t.DAY)}},t.dayOfWeekCount=t.dc={name:"day of week count",range:604800,val:function(e){return e.dc||(e.dc=Math.floor((t.D.val(e)-1)/7)+1)},isValid:function(e,n){return t.dc.val(e)===n||0===n&&t.D.val(e)>t.D.extent(e)[1]-7},extent:function(e){return e.dcExtent||(e.dcExtent=[1,Math.ceil(t.D.extent(e)[1]/7)])},start:function(e){return e.dcStart||(e.dcStart=t.date.next(t.Y.val(e),t.M.val(e),Math.max(1,7*(t.dc.val(e)-1)+1||1)))},end:function(e){return e.dcEnd||(e.dcEnd=t.date.prev(t.Y.val(e),t.M.val(e),Math.min(7*t.dc.val(e),t.D.extent(e)[1])))},next:function(e,n){n=n>t.dc.extent(e)[1]?1:n;var r=t.date.nextRollover(e,n,t.dc,t.M);n=n>t.dc.extent(r)[1]?1:n;var a=t.date.next(t.Y.val(r),t.M.val(r),0===n?t.D.extent(r)[1]-6:1+7*(n-1));return a.getTime()<=e.getTime()?(r=t.M.next(e,t.M.val(e)+1),t.date.next(t.Y.val(r),t.M.val(r),0===n?t.D.extent(r)[1]-6:1+7*(n-1))):a},prev:function(e,n){var r=t.date.prevRollover(e,n,t.dc,t.M),a=t.dc.extent(r)[1];return n=n>a?a:n||a,t.dc.end(t.date.prev(t.Y.val(r),t.M.val(r),1+7*(n-1)))}},t.dayOfWeek=t.dw=t.d={name:"day of week",range:86400,val:function(e){return e.dw||(e.dw=t.date.getDay.call(e)+1)},isValid:function(e,n){return t.dw.val(e)===(n||7)},extent:function(){return[1,7]},start:function(e){return t.D.start(e)},end:function(e){return t.D.end(e)},next:function(e,n){return n=n>7?1:n||7,t.date.next(t.Y.val(e),t.M.val(e),t.D.val(e)+(n-t.dw.val(e))+(n<=t.dw.val(e)?7:0))},prev:function(e,n){return n=n>7?7:n||7,t.date.prev(t.Y.val(e),t.M.val(e),t.D.val(e)+(n-t.dw.val(e))+(n>=t.dw.val(e)?-7:0))}},t.dayOfYear=t.dy={name:"day of year",range:86400,val:function(e){return e.dy||(e.dy=Math.ceil(1+(t.D.start(e).getTime()-t.Y.start(e).getTime())/t.DAY))},isValid:function(e,n){return t.dy.val(e)===(n||t.dy.extent(e)[1])},extent:function(e){var n=t.Y.val(e);return e.dyExtent||(e.dyExtent=[1,n%4?365:366])},start:function(e){return t.D.start(e)},end:function(e){return t.D.end(e)},next:function(e,n){n=n>t.dy.extent(e)[1]?1:n;var r=t.date.nextRollover(e,n,t.dy,t.Y),a=t.dy.extent(r)[1];return n=n>a?1:n||a,t.date.next(t.Y.val(r),t.M.val(r),n)},prev:function(e,n){var r=t.date.prevRollover(e,n,t.dy,t.Y),a=t.dy.extent(r)[1];return n=n>a?a:n||a,t.date.prev(t.Y.val(r),t.M.val(r),n)}},t.hour=t.h={name:"hour",range:3600,val:function(e){return e.h||(e.h=t.date.getHour.call(e))},isValid:function(e,n){return t.h.val(e)===n},extent:function(){return[0,23]},start:function(e){return e.hStart||(e.hStart=t.date.next(t.Y.val(e),t.M.val(e),t.D.val(e),t.h.val(e)))},end:function(e){return e.hEnd||(e.hEnd=t.date.prev(t.Y.val(e),t.M.val(e),t.D.val(e),t.h.val(e)))},next:function(e,n){n=n>23?0:n;var r=t.date.next(t.Y.val(e),t.M.val(e),t.D.val(e)+(n<=t.h.val(e)?1:0),n);return!t.date.isUTC&&r.getTime()<=e.getTime()&&(r=t.date.next(t.Y.val(r),t.M.val(r),t.D.val(r),n+1)),r},prev:function(e,n){return n=n>23?23:n,t.date.prev(t.Y.val(e),t.M.val(e),t.D.val(e)+(n>=t.h.val(e)?-1:0),n)}},t.minute=t.m={name:"minute",range:60,val:function(e){return e.m||(e.m=t.date.getMin.call(e))},isValid:function(e,n){return t.m.val(e)===n},extent:function(t){return[0,59]},start:function(e){return e.mStart||(e.mStart=t.date.next(t.Y.val(e),t.M.val(e),t.D.val(e),t.h.val(e),t.m.val(e)))},end:function(e){return e.mEnd||(e.mEnd=t.date.prev(t.Y.val(e),t.M.val(e),t.D.val(e),t.h.val(e),t.m.val(e)))},next:function(e,n){var r=t.m.val(e),a=t.s.val(e),i=n>59?60-r:n<=r?60-r+n:n-r,u=new Date(e.getTime()+i*t.MIN-a*t.SEC);return!t.date.isUTC&&u.getTime()<=e.getTime()&&(u=new Date(e.getTime()+(i+120)*t.MIN-a*t.SEC)),u},prev:function(e,n){return n=n>59?59:n,t.date.prev(t.Y.val(e),t.M.val(e),t.D.val(e),t.h.val(e)+(n>=t.m.val(e)?-1:0),n)}},t.month=t.M={name:"month",range:2629740,val:function(e){return e.M||(e.M=t.date.getMonth.call(e)+1)},isValid:function(e,n){return t.M.val(e)===(n||12)},extent:function(){return[1,12]},start:function(e){return e.MStart||(e.MStart=t.date.next(t.Y.val(e),t.M.val(e)))},end:function(e){return e.MEnd||(e.MEnd=t.date.prev(t.Y.val(e),t.M.val(e)))},next:function(e,n){return n=n>12?1:n||12,t.date.next(t.Y.val(e)+(n>t.M.val(e)?0:1),n)},prev:function(e,n){return n=n>12?12:n||12,t.date.prev(t.Y.val(e)-(n>=t.M.val(e)?1:0),n)}},t.monthEx=t.MX={name:"monthEx",range:2629740,val:function(e){return e.MX||(e.MX=t.date.diffInMonths(t.wy.start(t.DX.rangeStart),t.wy.start(e)))},isValid:function(e,n){return t.MX.val(e)===(n||t.MX.extent(e)[1])},extent:function(e){if(e.MXExtent)return e.MXExtent;var n=t.date.diffInMonths(t.wy.start(t.DX.rangeStart),t.wy.start(t.DX.rangeEnd));return e.MXExtent=[1,n]},start:function(e){return e.MXStart||(e.MXStart=t.date.next(t.Y.val(e),t.M.val(e)))},end:function(e){return e.MXEnd||(e.MXEnd=t.date.prev(t.Y.val(e),t.M.val(e)))},next:function(e,n){var r=new Date(t.wy.start(t.DX.rangeStart));return r.setMonth(r.getMonth()+n),r},prev:function(e,n){return n=n>12?12:n||12,t.date.prev(t.Y.val(e)-(n>=t.M.val(e)?1:0),n)}},t.second=t.s={name:"second",range:1,val:function(e){return e.s||(e.s=t.date.getSec.call(e))},isValid:function(e,n){return t.s.val(e)===n},extent:function(){return[0,59]},start:function(t){return t},end:function(t){return t},next:function(e,n){var r=t.s.val(e),a=n>59?60-r:n<=r?60-r+n:n-r,i=new Date(e.getTime()+a*t.SEC);return!t.date.isUTC&&i.getTime()<=e.getTime()&&(i=new Date(e.getTime()+(a+7200)*t.SEC)),i},prev:function(e,n,r){return n=n>59?59:n,t.date.prev(t.Y.val(e),t.M.val(e),t.D.val(e),t.h.val(e),t.m.val(e)+(n>=t.s.val(e)?-1:0),n)}},t.time=t.t={name:"time",range:1,val:function(e){return e.t||(e.t=3600*t.h.val(e)+60*t.m.val(e)+t.s.val(e))},isValid:function(e,n){return t.t.val(e)===n},extent:function(){return[0,86399]},start:function(t){return t},end:function(t){return t},next:function(e,n){n=n>86399?0:n;var r=t.date.next(t.Y.val(e),t.M.val(e),t.D.val(e)+(n<=t.t.val(e)?1:0),0,0,n);return!t.date.isUTC&&r.getTime()<e.getTime()&&(r=t.date.next(t.Y.val(r),t.M.val(r),t.D.val(r),t.h.val(r),t.m.val(r),n+7200)),r},prev:function(e,n){return n=n>86399?86399:n,t.date.next(t.Y.val(e),t.M.val(e),t.D.val(e)+(n>=t.t.val(e)?-1:0),0,0,n)}},t.weekOfMonth=t.wm={name:"week of month",range:604800,val:function(e){return e.wm||(e.wm=(t.D.val(e)+(t.dw.val(t.M.start(e))-1)+(7-t.dw.val(e)))/7)},isValid:function(e,n){return t.wm.val(e)===(n||t.wm.extent(e)[1])},extent:function(e){return e.wmExtent||(e.wmExtent=[1,(t.D.extent(e)[1]+(t.dw.val(t.M.start(e))-1)+(7-t.dw.val(t.M.end(e))))/7])},start:function(e){return e.wmStart||(e.wmStart=t.date.next(t.Y.val(e),t.M.val(e),Math.max(t.D.val(e)-t.dw.val(e)+1,1)))},end:function(e){return e.wmEnd||(e.wmEnd=t.date.prev(t.Y.val(e),t.M.val(e),Math.min(t.D.val(e)+(7-t.dw.val(e)),t.D.extent(e)[1])))},next:function(e,n){n=n>t.wm.extent(e)[1]?1:n;var r=t.date.nextRollover(e,n,t.wm,t.M),a=t.wm.extent(r)[1];return n=n>a?1:n||a,t.date.next(t.Y.val(r),t.M.val(r),Math.max(1,7*(n-1)-(t.dw.val(r)-2)))},prev:function(e,n){var r=t.date.prevRollover(e,n,t.wm,t.M),a=t.wm.extent(r)[1];return n=n>a?a:n||a,t.wm.end(t.date.next(t.Y.val(r),t.M.val(r),Math.max(1,7*(n-1)-(t.dw.val(r)-2))))}},t.weekOfYear=t.wy={name:"week of year (ISO)",range:604800,val:function(e){if(e.wy)return e.wy;var n=t.dw.next(t.wy.start(e),5),r=t.dw.next(t.Y.prev(n,t.Y.val(n)-1),5);return e.wy=1+Math.ceil((n.getTime()-r.getTime())/t.WEEK)},isValid:function(e,n){return t.wy.val(e)===(n||t.wy.extent(e)[1])},extent:function(e){if(e.wyExtent)return e.wyExtent;var n=t.dw.next(t.wy.start(e),5),r=t.dw.val(t.Y.start(n)),a=t.dw.val(t.Y.end(n));return e.wyExtent=[1,5===r||5===a?53:52]},start:function(e){return e.wyStart||(e.wyStart=t.date.next(t.Y.val(e),t.M.val(e),t.D.val(e)-(t.dw.val(e)>1?t.dw.val(e)-2:6)))},end:function(e){return e.wyEnd||(e.wyEnd=t.date.prev(t.Y.val(e),t.M.val(e),t.D.val(e)+(t.dw.val(e)>1?8-t.dw.val(e):0)))},next:function(e,n){n=n>t.wy.extent(e)[1]?1:n;var r=t.dw.next(t.wy.start(e),5),a=t.date.nextRollover(r,n,t.wy,t.Y);1!==t.wy.val(a)&&(a=t.dw.next(a,2));var i=t.wy.extent(a)[1],u=t.wy.start(a);return n=n>i?1:n||i,t.date.next(t.Y.val(u),t.M.val(u),t.D.val(u)+7*(n-1))},prev:function(e,n){var r=t.dw.next(t.wy.start(e),5),a=t.date.prevRollover(r,n,t.wy,t.Y);1!==t.wy.val(a)&&(a=t.dw.next(a,2));var i=t.wy.extent(a)[1],u=t.wy.end(a);return n=n>i?i:n||i,t.wy.end(t.date.next(t.Y.val(u),t.M.val(u),t.D.val(u)+7*(n-1)))}},t.weekEx=t.WX={name:"weekEx",range:604800,val:function(e){return e.WX?e.WX:e.WX=Math.ceil(t.date.diffInDays(t.wy.start(t.DX.rangeStart),e)/7)},isValid:function(e,n){return t.WX.val(e)===(n||t.WX.extent(e)[1])},extent:function(e){if(e.WXExtent)return e.WXExtent;var n=Math.floor(t.date.diffInDays(t.wy.start(t.DX.rangeStart),t.wy.start(t.DX.rangeEnd))/7);return e.WXExtent=[1,n]},start:function(e){return e.WXStart||(e.WXStart=t.date.next(t.Y.val(e),t.M.val(e),t.D.val(e)-(t.dw.val(e)>1?t.dw.val(e)-2:6)))},end:function(e){return e.WXEnd||(e.WXEnd=t.date.prev(t.Y.val(e),t.M.val(e),t.D.val(e)+(t.dw.val(e)>1?8-t.dw.val(e):0)))},next:function(e,n){return new Date(t.wy.start(t.DX.rangeStart).getTime()+n*t.WEEK)},prev:function(e,n){return new Date(t.wy.start(t.DX.rangeStart).getTime()+n*t.WEEK)}},t.year=t.Y={name:"year",range:31556900,val:function(e){return e.Y||(e.Y=t.date.getYear.call(e))},isValid:function(e,n){return t.Y.val(e)===n},extent:function(){return[1970,2099]},start:function(e){return e.YStart||(e.YStart=t.date.next(t.Y.val(e)))},end:function(e){return e.YEnd||(e.YEnd=t.date.prev(t.Y.val(e)))},next:function(e,n){return n>t.Y.val(e)&&n<=t.Y.extent()[1]?t.date.next(n):t.NEVER},prev:function(e,n){return n<t.Y.val(e)&&n>=t.Y.extent()[0]?t.date.prev(n):t.NEVER}},t.fullDate=t.fd={name:"full date",range:1,val:function(t){return t.fd||(t.fd=t.getTime())},isValid:function(e,n){return t.fd.val(e)===n},extent:function(){return[0,3250368e7]},start:function(t){return t},end:function(t){return t},next:function(e,n){return t.fd.val(e)<n?new Date(n):t.NEVER},prev:function(e,n){return t.fd.val(e)>n?new Date(n):t.NEVER}},t.modifier={},t.modifier.after=t.modifier.a=function(t,e){var n=e[0];return{name:"after "+t.name,range:(t.extent(new Date)[1]-n)*t.range,val:t.val,isValid:function(t,e){return this.val(t)>=n},extent:t.extent,start:t.start,end:t.end,next:function(e,r){return r!=n&&(r=t.extent(e)[0]),t.next(e,r)},prev:function(e,r){return r=r===n?t.extent(e)[1]:n-1,t.prev(e,r)}}},t.modifier.before=t.modifier.b=function(t,e){var n=e[e.length-1];return{name:"before "+t.name,range:t.range*(n-1),val:t.val,isValid:function(t,e){return this.val(t)<n},extent:t.extent,start:t.start,end:t.end,next:function(e,r){return r=r===n?t.extent(e)[0]:n,t.next(e,r)},prev:function(e,r){return r=r===n?n-1:t.extent(e)[1],t.prev(e,r)}}},t.compile=function(e){function n(t){return"next"===t?function(t,e){return t.getTime()>e.getTime()}:function(t,e){return e.getTime()>t.getTime()}}var r,a=[],i=0;for(var u in e){var o=u.split("_"),f=o[0],d=o[1],v=e[u],l=d?t.modifier[d](t[f],v):t[f];a.push({constraint:l,vals:v}),i++}return a.sort(function(t,e){var n=t.constraint.range,r=e.constraint.range;return r<n?-1:r>n?1:0}),r=a[i-1].constraint,{start:function(e,n){for(var u,o=n,f=t.array[e],d=1e3;d--&&!u&&o;){u=!0;for(var v=0;v<i;v++){var l=a[v].constraint,c=l.val(o),s=l.extent(o),h=f(c,a[v].vals,s);if(!l.isValid(o,h)){o=l[e](o,h),u=!1;break}}}return o!==t.NEVER&&(o="next"===e?r.start(o):r.end(o)),o},end:function(e,r){for(var u,o=t.array[e+"Invalid"],f=n(e),d=i-1;d>=0;d--){var v,l=a[d].constraint,c=l.val(r),s=l.extent(r),h=o(c,a[d].vals,s);void 0!==h&&(!(v=l[e](r,h))||u&&!f(u,v)||(u=v))}return u},tick:function(e,n){return new Date("next"===e?r.end(n).getTime()+t.SEC:r.start(n).getTime()-t.SEC)},tickStart:function(t){return r.start(t)}}},t.schedule=function(e){function n(e,n,m,D,y){var p,M,E,Y=s(e),b=n,k=1e3,T=[],O=[],S=[],X="next"===e,N=X?0:1,W=X?1:0;if(!(m=m?new Date(m):new Date)||!m.getTime())throw new Error("Invalid start date.");for(a(e,x,T,m),u(e,w,O,m);k--&&b&&(p=h(T,Y))&&(!D||!Y(p,D));)if(g&&(o(e,w,O,p),M=v(e,O,p)))i(e,x,T,M);else{if(y){var R=l(O,Y);M=c(e,x,T,p,R);var I=X?[new Date(Math.max(m,p)),M?new Date(D?Math.min(M,D):M):void 0]:[M?new Date(D?Math.max(D,M.getTime()+t.SEC):M.getTime()+t.SEC):void 0,new Date(Math.min(m,p.getTime()+t.SEC))];if(E&&I[N].getTime()===E[W].getTime()?(E[W]=I[W],b++):(E=I,S.push(E)),!M)break;i(e,x,T,M)}else S.push(X?new Date(Math.max(m,p)):d(x,T,p,D)),f(e,x,T,p);b--}for(var C=0,V=S.length;C<V;C++){var A=S[C];S[C]="[object Array]"===Object.prototype.toString.call(A)?[r(A[0]),r(A[1])]:r(A)}return 0===S.length?t.NEVER:1===n?S[0]:S}function r(t){if(t instanceof Date&&!isNaN(t.valueOf()))return new Date(t)}function a(t,e,n,r){for(var a=0,i=e.length;a<i;a++)n[a]=e[a].start(t,r)}function i(t,e,n,r){for(var a=s(t),i=0,u=e.length;i<u;i++)n[i]&&!a(n[i],r)&&(n[i]=e[i].start(t,r))}function u(e,n,r,a){for(var i=(s(e),0),u=n.length;i<u;i++){var o=n[i].start(e,a);r[i]=o?[o,n[i].end(e,o)]:t.NEVER}}function o(e,n,r,a){for(var i=s(e),u=0,o=n.length;u<o;u++)if(r[u]&&!i(r[u][0],a)){var f=n[u].start(e,a);r[u]=f?[f,n[u].end(e,f)]:t.NEVER}}function f(t,e,n,r){for(var a=0,i=e.length;a<i;a++)n[a]&&n[a].getTime()===r.getTime()&&(n[a]=e[a].start(t,e[a].tick(t,r)))}function d(t,e,n,r){for(var a,i=0,u=e.length;i<u;i++)if(e[i]&&e[i].getTime()===n.getTime()){var o=t[i].tickStart(n);if(r&&o<r)return r;(!a||o>a)&&(a=o)}return a}function v(t,e,n){for(var r,a=s(t),i=0,u=e.length;i<u;i++){var o=e[i];!o||a(o[0],n)||o[1]&&!a(o[1],n)||r&&!a(o[1],r)||(r=o[1])}return r}function l(t,e){for(var n,r=0,a=t.length;r<a;r++)!t[r]||n&&!e(n,t[r][0])||(n=t[r][0]);return n}function c(t,e,n,r,a){for(var i,u=s(t),o=0,f=e.length;o<f;o++){var d=n[o];if(d&&d.getTime()===r.getTime()){var v=e[o].end(t,d);if(a&&(!v||u(v,a)))return a;i&&!u(v,i)||(i=v)}}return i}function s(t){return"next"===t?function(t,e){return!e||t.getTime()>e.getTime()}:function(t,e){return!t||e.getTime()>t.getTime()}}function h(t,e){for(var n=t[0],r=1,a=t.length;r<a;r++)t[r]&&e(n,t[r])&&(n=t[r]);return n}if(!e)throw new Error("Missing schedule definition.");if(!e.schedules)throw new Error("Definition must include at least one schedule.");for(var x=[],m=e.schedules.length,w=[],g=e.exceptions?e.exceptions.length:0,D=0;D<m;D++)x.push(t.compile(e.schedules[D]));for(var y=0;y<g;y++)w.push(t.compile(e.exceptions[y]));return{isValid:function(e){return n("next",1,e,e)!==t.NEVER},next:function(t,e,r){return n("next",t||1,e,r)},prev:function(t,e,r){return n("prev",t||1,e,r)},nextRange:function(t,e,r){return n("next",t||1,e,r,!0)},prevRange:function(t,e,r){return n("prev",t||1,e,r,!0)}}},t.setTimeout=function(e,n){function r(){var t=Date.now(),n=i.next(2,t);if(!n[0])return void(a=void 0);var u=n[0].getTime()-t;u<1e3&&(u=n[1]?n[1].getTime()-t:1e3),a=u<2147483647?setTimeout(e,u):setTimeout(r,2147483647)}var a,i=t.schedule(n);return e&&r(),{isDone:function(){return!a},clear:function(){clearTimeout(a)}}},t.setInterval=function(e,n){function r(){i||(e(),a=t.setTimeout(r,n))}if(e){var a=t.setTimeout(r,n),i=a.isDone();return{isDone:function(){return a.isDone()},clear:function(){i=!0,a.clear()}}}},t.date={},t.date.timezone=function(e){t.date.build=e?function(t,e,n,r,a,i){return new Date(t,e,n,r,a,i)}:function(t,e,n,r,a,i){return new Date(Date.UTC(t,e,n,r,a,i))};var n=e?"get":"getUTC",r=Date.prototype;t.date.getYear=r[n+"FullYear"],t.date.getMonth=r[n+"Month"],t.date.getDate=r[n+"Date"],t.date.getDay=r[n+"Day"],t.date.getHour=r[n+"Hours"],t.date.getMin=r[n+"Minutes"],t.date.getSec=r[n+"Seconds"],t.date.isUTC=!e},t.date.UTC=function(){t.date.timezone(!1)},t.date.localTime=function(){t.date.timezone(!0)},t.date.UTC(),t.SEC=1e3,t.MIN=60*t.SEC,t.HOUR=60*t.MIN,t.DAY=24*t.HOUR,t.WEEK=7*t.DAY,t.DAYS_IN_MONTH=[31,28,31,30,31,30,31,31,30,31,30,31],t.NEVER=0,t.date.next=function(e,n,r,a,i,u){return t.date.build(e,void 0!==n?n-1:0,void 0!==r?r:1,a||0,i||0,u||0)},t.date.nextRollover=function(e,n,r,a){var i=r.val(e),u=r.extent(e)[1];return(n||u)<=i||n>u?new Date(a.end(e).getTime()+t.SEC):a.start(e)},t.date.prev=function(e,n,r,a,i,u){var o=arguments.length;return n=o<2?11:n-1,r=o<3?t.D.extent(t.date.next(e,n+1))[1]:r,a=o<4?23:a,i=o<5?59:i,u=o<6?59:u,t.date.build(e,n,r,a,i,u)},t.date.prevRollover=function(t,e,n,r){return e>=n.val(t)||!e?r.start(r.prev(t,r.val(t)-1)):r.start(t)},t.date.diffInDays=function(e,n){return Math.floor((Date.UTC(n.getFullYear(),n.getMonth(),n.getDate())-Date.UTC(e.getFullYear(),e.getMonth(),e.getDate()))/t.DAY)},t.date.diffInMonths=function(t,e){var n=12*(e.getFullYear()-t.getFullYear())+(e.getMonth()-t.getMonth());return n<=0?0:n},t.parse={},t.parse.cron=function(t,e){function n(t,e,n){return isNaN(t)?l[t]||null:Math.min(+t+(e||0),n||9999)}function r(t){var e,n={};for(e in t)"dc"!==e&&"d"!==e&&(n[e]=t[e].slice(0));return n}function a(t,e,n,r,a){var i=n;for(t[e]||(t[e]=[]);i<=r;)t[e].indexOf(i)<0&&t[e].push(i),i+=a||1;t[e].sort(function(t,e){return t-e})}function i(t,e,n,i){(e.d&&!e.dc||e.dc&&e.dc.indexOf(i)<0)&&(t.push(r(e)),e=t[t.length-1]),a(e,"d",n,n),a(e,"dc",i,i)}function u(t,e,n){var r={},i={};1===n?(a(e,"D",1,3),a(e,"d",l.MON,l.FRI),a(r,"D",2,2),a(r,"d",l.TUE,l.FRI),a(i,"D",3,3),a(i,"d",l.TUE,l.FRI)):(a(e,"D",n-1,n+1),a(e,"d",l.MON,l.FRI),a(r,"D",n-1,n-1),a(r,"d",l.MON,l.THU),a(i,"D",n+1,n+1),a(i,"d",l.TUE,l.FRI)),t.exceptions.push(r),t.exceptions.push(i)}function o(t,e,r,i,u,o){var f=t.split("/"),d=+f[1],v=f[0];if("*"!==v&&"0"!==v){var l=v.split("-");i=n(l[0],o,u),u=n(l[1],o,u)||u}a(e,r,i,u,d)}function f(t,e,r,f,d,v){var l,c,s=e.schedules,h=s[s.length-1];"L"===t&&(t=f-1),null!==(l=n(t,v,d))?a(h,r,l,l):null!==(l=n(t.replace("W",""),v,d))?u(e,h,l):null!==(l=n(t.replace("L",""),v,d))?i(s,h,l,f-1):2===(c=t.split("#")).length?(l=n(c[0],v,d),i(s,h,l,n(c[1]))):o(t,h,r,f,d,v)}function d(t){return t.indexOf("#")>-1||t.indexOf("L")>0}function v(t,e){return d(t)&&!d(e)?1:t-e}var l={JAN:1,FEB:2,MAR:3,APR:4,MAY:5,JUN:6,JUL:7,AUG:8,SEP:9,OCT:10,NOV:11,DEC:12,SUN:1,MON:2,TUE:3,WED:4,THU:5,FRI:6,SAT:7},c={"* * * * * *":"0/1 * * * * *","@YEARLY":"0 0 1 1 *","@ANNUALLY":"0 0 1 1 *","@MONTHLY":"0 0 1 * *","@WEEKLY":"0 0 * * 0","@DAILY":"0 0 * * *","@HOURLY":"0 * * * *"},s={s:[0,0,59],m:[1,0,59],h:[2,0,23],D:[3,1,31],M:[4,1,12],Y:[6,1970,2099],d:[5,1,7,1]},h=function(t){var e=t.toUpperCase();return c[e]||e}(t);return function(t){var e,n,r,a,i={schedules:[{}],exceptions:[]},u=t.replace(/(\s)+/g," ").split(" ");for(e in s)if(n=s[e],(r=u[n[0]])&&"*"!==r&&"?"!==r){a=r.split(",").sort(v);var o,d=a.length;for(o=0;o<d;o++)f(a[o],i,e,n[1],n[2],n[3])}return i}(e?h:"0 "+h)},t.parse.recur=function(){function e(t,e,l){if(t=u?t+"_"+u:t,n||(s.push({}),n=s[0]),n[t]||(n[t]=[]),r=n[t],i){for(a=[],d=e;d<=l;d+=i)a.push(d);v={n:t,x:i,c:r.length,m:l}}a=o?[e]:f?[l]:a;var c=a.length;for(d=0;d<c;d+=1){var h=a[d];r.indexOf(h)<0&&r.push(h)}a=i=u=o=f=0}var n,r,a,i,u,o,f,d,v,l=[],c=[],s=l;return{schedules:l,exceptions:c,on:function(){return a=arguments[0]instanceof Array?arguments[0]:arguments,this},every:function(t){return i=t||1,this},after:function(t){return u="a",a=[t],this},before:function(t){return u="b",a=[t],this},first:function(){return o=1,this},last:function(){return f=1,this},time:function(){for(var t=0,n=a.length;t<n;t++){var r=a[t].split(":");r.length<3&&r.push(0),a[t]=3600*+r[0]+60*+r[1]+ +r[2]}return e("t"),this},second:function(){return e("s",0,59),this},minute:function(){return e("m",0,59),this},hour:function(){return e("h",0,23),this},dayOfMonth:function(){return e("D",1,f?0:31),this},dayOfWeek:function(){return e("d",1,7),this},onWeekend:function(){return a=[1,7],this.dayOfWeek()},onWeekday:function(){return a=[2,3,4,5,6],this.dayOfWeek()},dayOfWeekCount:function(){return e("dc",1,f?0:5),this},dayOfYear:function(){return e("dy",1,f?0:366),this},dayEx:function(){var n=t.DX.extent(new Date);return e("DX",n[0],n[1]),this},weekOfMonth:function(){return e("wm",1,f?0:5),this},weekOfYear:function(){return e("wy",1,f?0:53),this},weekEx:function(){var n=t.WX.extent(new Date);return e("WX",n[0],n[1]),this},month:function(){return e("M",1,12),this},monthEx:function(){var n=t.MX.extent(new Date);return e("MX",n[0],n[1]),this},year:function(){return e("Y",1970,2450),this},fullDate:function(){for(var t=0,n=a.length;t<n;t++)a[t]=a[t].getTime();return e("fd"),this},customModifier:function(e,n){if(!t.modifier[e])throw new Error("Custom modifier "+e+" not recognized!");return u=e,a=arguments[1]instanceof Array?arguments[1]:[arguments[1]],this},customPeriod:function(n){var r=t[n];if(!r)throw new Error("Custom time period "+n+" not recognized!");return e(n,r.extent(new Date)[0],r.extent(new Date)[1]),this},reference:function(e){e=new Date(e);var n=t[v.n].val(e)%v.x;return this.between(n,v.m)},startingOn:function(t){return this.between(t,v.m)},between:function(t,r){return n[v.n]=n[v.n].splice(0,v.c),i=v.x,e(v.n,t,r),this},and:function(){return n=s[s.push({})-1],this},except:function(){return s=c,n=null,this}}},t.parse.text=function(e){function n(t,e,n,r){return{startPos:t,endPos:e,text:n,type:r}}function r(t){var e,r,a,i,u,o,f=t instanceof Array?t:[t],d=/\s+/;for(f.push(d),u=m;!e||e.type===d;){o=-1,r=w.substring(u),e=n(u,u,w.split(d)[0]);var v,l=f.length;for(v=0;v<l;v++)i=f[v],(a=i.exec(r))&&0===a.index&&a[0].length>o&&(o=a[0].length,e=n(u,u+o,r.substring(0,o),i));e.type===d&&(u=e.endPos)}return e}function a(t){var e=r(t);return m=e.endPos,e}function i(t){for(var e=+c(t),n=v(g.through)?+c(t):e,r=[],a=e;a<=n;a++)r.push(a);return r}function u(t){for(var e=i(t);v(g.and);)e=e.concat(i(t));return e}function o(t){var e,n,r,a;v(g.weekend)?t.on(D.sun,D.sat).dayOfWeek():v(g.weekday)?t.on(D.mon,D.tue,D.wed,D.thu,D.fri).dayOfWeek():(e=c(g.rank),t.every(e),n=d(t),v(g.start)?(e=c(g.rank),t.startingOn(e),l(n.type)):v(g.between)&&(r=c(g.rank),v(g.and)&&(a=c(g.rank),t.between(r,a))))}function f(t){v(g.first)?t.first():v(g.last)?t.last():t.on(u(g.rank)),d(t)}function d(t){var e=l([g.second,g.minute,g.hour,g.dayOfYear,g.dayOfWeek,g.dayInstance,g.day,g.month,g.year,g.weekOfMonth,g.weekOfYear]);switch(e.type){case g.second:t.second();break;case g.minute:t.minute();break;case g.hour:t.hour();break;case g.dayOfYear:t.dayOfYear();break;case g.dayOfWeek:t.dayOfWeek();break;case g.dayInstance:t.dayOfWeekCount();break;case g.day:t.dayOfMonth();break;case g.weekOfMonth:t.weekOfMonth();break;case g.weekOfYear:t.weekOfYear();break;case g.month:t.month();break;case g.year:t.year();break;default:h=m}return e}function v(t){var e=r(t).type===t;return e&&a(t),e}function l(t){var e=a(t);return e.type?e.text=s(e.text,t):h=m,e}function c(t){return l(t).text}function s(t,e){var n=t;switch(e){case g.time:var r=t.split(/(:|am|pm)/),a="pm"===r[3]&&r[0]<12?parseInt(r[0],10)+12:r[0],i=r[2].trim();n=(1===a.length?"0":"")+a+":"+i;break;case g.rank:n=parseInt(/^\d+/.exec(t)[0],10);break;case g.monthName:case g.dayName:n=D[t.substring(0,3)]}return n}var h,x=t.parse.recur,m=0,w="",g={eof:/^$/,rank:/^((\d+)(st|nd|rd|th)?)\b/,time:/^((([0]?[1-9]|1[0-2]):[0-5]\d(\s)?(am|pm))|(([0]?\d|1\d|2[0-3]):[0-5]\d))\b/,dayName:/^((sun|mon|tue(s)?|wed(nes)?|thu(r(s)?)?|fri|sat(ur)?)(day)?)\b/,monthName:/^(jan(uary)?|feb(ruary)?|ma((r(ch)?)?|y)|apr(il)?|ju(ly|ne)|aug(ust)?|oct(ober)?|(sept|nov|dec)(ember)?)\b/,yearIndex:/^(\d\d\d\d)\b/,every:/^every\b/,after:/^after\b/,before:/^before\b/,second:/^(s|sec(ond)?(s)?)\b/,minute:/^(m|min(ute)?(s)?)\b/,hour:/^(h|hour(s)?)\b/,day:/^(day(s)?( of the month)?)\b/,dayInstance:/^day instance\b/,dayOfWeek:/^day(s)? of the week\b/,dayOfYear:/^day(s)? of the year\b/,weekOfYear:/^week(s)?( of the year)?\b/,weekOfMonth:/^week(s)? of the month\b/,weekday:/^weekday\b/,weekend:/^weekend\b/,month:/^month(s)?\b/,year:/^year(s)?\b/,between:/^between (the)?\b/,start:/^(start(ing)? (at|on( the)?)?)\b/,at:/^(at|@)\b/,and:/^(,|and\b)/,except:/^(except\b)/,also:/(also)\b/,first:/^(first)\b/,last:/^last\b/,in:/^in\b/,of:/^of\b/,onthe:/^on the\b/,on:/^on\b/,through:/(-|^(to|through)\b)/},D={jan:1,feb:2,mar:3,apr:4,may:5,jun:6,jul:7,aug:8,sep:9,oct:10,nov:11,dec:12,sun:1,mon:2,tue:3,wed:4,thu:5,fri:6,sat:7,"1st":1,fir:1,"2nd":2,sec:2,"3rd":3,thi:3,"4th":4,for:4};return function(t){m=0,w=t,h=-1;for(var e=x();m<w.length&&h<0;){switch(l([g.every,g.after,g.before,g.onthe,g.on,g.of,g.in,g.at,g.and,g.except,g.also]).type){case g.every:o(e);break;case g.after:void 0!==r(g.time).type?(e.after(c(g.time)),e.time()):(e.after(c(g.rank)),d(e));break;case g.before:void 0!==r(g.time).type?(e.before(c(g.time)),e.time()):(e.before(c(g.rank)),d(e));break;case g.onthe:f(e);break;case g.on:e.on(u(g.dayName)).dayOfWeek();break;case g.of:e.on(u(g.monthName)).month();break;case g.in:e.on(u(g.yearIndex)).year();break;case g.at:for(e.on(c(g.time)).time();v(g.and);)e.on(c(g.time)).time();break;case g.and:break;case g.also:e.and();break;case g.except:e.except();break;default:h=m}}return{schedules:e.schedules,exceptions:e.exceptions,error:h}}(e.toLowerCase())},t}();